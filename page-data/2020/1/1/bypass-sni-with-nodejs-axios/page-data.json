{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2020/1/1/bypass-sni-with-nodejs-axios","result":{"data":{"content":{"edges":[{"node":{"id":"ae30dbd0-a845-58c7-9ba7-6b366cf296d6","html":"<p>참고 : <a href=\"https://stackoverflow.com/questions/46779881/how-can-i-disable-sni-for-a-request-in-node\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How can i Disable SNI for a request in node?</a></p>\n<p>대한민국은 현재 특정 사이트가 검열하는 검열국가. 차단 방식은</p>\n<ul>\n<li>도메인 검열을 통한 warning 페이지 리다이렉션</li>\n<li>https 페이지의 경우 SNI 필드 감청을 통한 패킷드랍</li>\n</ul>\n<p>워닝페이지 리다이렉션은 https 프로토콜을 막지 못했고, 이를 막기 위해 패킷감청도 하고 있다.</p>\n<p>그러나 사람들은 vpn 이나 패킷암호화 앱등을 통해서 볼거할거 다하고 있긴한데.. 나도 어느날 문득 이런 궁금증이 생겼었다.</p>\n<p><code>SNI 필드를 나도 직접 다룰 수 있다면 이 값을 제어해서 간단하게 우회할 수 있지 않을까?</code></p>\n<hr>\n<p>일단 코드는 이렇다.</p>\n<p><div id=\"gist100325893\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-axioscreator-ts\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-typescript \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-axioscreator-ts-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-axioscreator-ts-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>axios</span> <span class=pl-k>from</span> <span class=pl-s>&#39;axios&#39;</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-axioscreator-ts-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>tls</span> <span class=pl-k>from</span> <span class=pl-s>&#39;tls&#39;</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-axioscreator-ts-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>https</span> <span class=pl-k>from</span> <span class=pl-s>&#39;https&#39;</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-axioscreator-ts-LC4\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-axioscreator-ts-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>const</span> <span class=pl-s1>agent</span> <span class=pl-c1>=</span> <span class=pl-k>new</span> <span class=pl-s1>https</span><span class=pl-kos>.</span><span class=pl-c1>Agent</span><span class=pl-kos>(</span><span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-axioscreator-ts-LC6\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c1>rejectUnauthorized</span>: <span class=pl-c1>true</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-axioscreator-ts-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c>// <span class=pl-k>@ts</span>-ignore</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-axioscreator-ts-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-c1>headers</span>: <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-axioscreator-ts-LC9\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s>&#39;User-Agent&#39;</span>: <span class=pl-s>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36&#39;</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-axioscreator-ts-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-kos>}</span><span class=pl-kos>,</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-axioscreator-ts-LC11\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-kos>}</span><span class=pl-kos>)</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-axioscreator-ts-LC12\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-axioscreator-ts-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-c>// <span class=pl-k>@ts</span>-ignore</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-axioscreator-ts-LC14\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-s1>agent</span><span class=pl-kos>.</span><span class=pl-en>createConnection</span> <span class=pl-c1>=</span> <span class=pl-k>function</span> <span class=pl-kos>(</span><span class=pl-s1>options</span><span class=pl-kos>,</span> <span class=pl-s1>callback</span><span class=pl-kos>)</span> <span class=pl-kos>{</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-axioscreator-ts-LC15\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>options</span><span class=pl-kos>.</span><span class=pl-c1>servername</span> <span class=pl-c1>=</span> undefined<span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-axioscreator-ts-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>return</span> <span class=pl-s1>tls</span><span class=pl-kos>.</span><span class=pl-en>connect</span><span class=pl-kos>(</span><span class=pl-s1>options</span><span class=pl-kos>,</span> <span class=pl-s1>callback</span><span class=pl-kos>)</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-axioscreator-ts-LC17\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-kos>}</span><span class=pl-kos>;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-axioscreator-ts-LC18\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-axioscreator-ts-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-axioscreator-ts-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>export</span> <span class=pl-k>default</span> <span class=pl-s1>axios</span><span class=pl-kos>.</span><span class=pl-en>create</span><span class=pl-kos>(</span><span class=pl-kos>{</span> <span class=pl-c1>httpsAgent</span>: <span class=pl-s1>agent</span> <span class=pl-kos>}</span><span class=pl-kos>)</span><span class=pl-kos>;</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/extracold1209/86289c4885da09450fca5dc1cdbe2bc1/raw/5c5fc5f48dd01d43e2753bcd02fc7a47085e1f44/axiosCreator.ts\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/extracold1209/86289c4885da09450fca5dc1cdbe2bc1#file-axioscreator-ts\">axiosCreator.ts</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>코드가 굉장히 심플하다.</p>\n<p>axios 는 httpsAgent 로 변형된 에이전트를 사용하게 되는데, 각 줄의 뜻은 아래와 같다.</p>\n<ul>\n<li>rejectUnauthorized#L6: false 로 두면 CA 로 부터 인증받지 않은 https 인증서를 사용하는 사이트도 연결을 맺을 수 있다.</li>\n<li>headers#L8: 별 의미는 없다. agent 를 속이기 위함. 없어도 된다.</li>\n<li><strong>options.servername#L15</strong>: 중요한 부분은 얘인데, 이것이 SNI 검열용 필드에 속한다.\n동일 호스트, 다중 도메인을 위해 존재하는 이 서버네임을 검열용으로 사용하고 있는데, 이를 undefined 로 치환해버리면 이름을 알 수 없으므로 검열을 피할 수 있다.</li>\n</ul>\n<p>그럼, servername 을 undefined 로 변경해버리면 문제가 있지 않을까?\n동일 IP 에 다양한 호스트를 운영하는 사이트에 접속하고자 하는 경우 문제가 발생할 수도 있을지 모르겠지만, 정확히는 잘 모르겠다.</p>\n<hr>\n<p>이렇게 만들어진 axios 를 통해 요청을 보내보면, 정상적으로 요청을 받을 수 있다.</p>","excerpt":"참고 : How can i Disable SNI for a request in node? 대한민국은 현재 특정 사이트가 검열하는 검열국가. 차단 방식은 도메인 검열을 통한 warning 페이지 리다이렉션 https 페이지의 경우 SNI…","fields":{"slug":"/2020/1/1/bypass-sni-with-nodejs-axios"},"frontmatter":{"id":"74c35670-2c61-11ea-9e56-f168f23df4cb","title":"nodejs, axios 만으로 SNI 검열 우회하기","slug":"/2020/1/1/bypass-sni-with-nodejs-axios","date":"2020-01-01T06:39:27.061Z","headerImage":""}},"previous":null,"next":null}]}},"pageContext":{"id":"ae30dbd0-a845-58c7-9ba7-6b366cf296d6","index":3}}}